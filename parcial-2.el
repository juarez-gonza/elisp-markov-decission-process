(add-to-list 'load-path "./")
(require 'mdp-lib)

;; Question 3

(define-mdp question-3
  :neutral ((:name Aggressive :cost 10 :neutral 0.3 :favorable 0.6 :opposite 0.1)
	    (:name Standard :cost 5 :neutral 0.8 :favorable 0.2))
  :opposite ((:name Aggressive :cost 10 :neutral 0.55 :favorable 0.2 :opposite 0.25)
	    (:name Standard :cost 5 :neutral 0.4 :favorable 0.1 :opposite 0.5))
  :favorable ())

;; (solve&log-mdp question-3)

;; iter 0 ((:neutral . 0.0) (:opposite . 0.0) (:favorable . 0.0))
;; iter 1 ((:neutral . 5.0) (:opposite . 5.0) (:favorable . 0))
;; iter 2 ((:neutral . 9.0) (:opposite . 9.5) (:favorable . 0))
;; iter 3 ((:neutral . 12.2) (:opposite . 13.35) (:favorable . 0))
;; iter 4 ((:neutral . 14.76) (:opposite . 16.555) (:favorable . 0))
;; iter 5 ((:neutral . 16.0835) (:opposite . 19.1815) (:favorable . 0))
;; iter 6 ((:neutral . 16.7432) (:opposite . 21.02415) (:favorable . 0))
;; iter 7 ((:neutral . 17.125375) (:opposite . 22.209355000000002) (:favorable . 0))
;; iter 8 ((:neutral . 17.358548) (:opposite . 22.9548275) (:favorable . 0))
;; iter 9 ((:neutral . 17.50304715) (:opposite . 23.42083295) (:favorable . 0))
;; iter 10 ((:neutral . 17.59299744) (:opposite . 23.711635335) (:favorable . 0))
;; iter 11 ((:neutral . 17.6490627655) (:opposite . 23.8930166435) (:favorable . 0))
;; iter 12 ((:neutral . 17.684020494) (:opposite . 24.00613342795) (:favorable . 0))
;; iter 13 ((:neutral . 17.705819490994998) (:opposite . 24.076674911575) (:favorable . 0))
;; iter 14 ((:neutral . 17.719413338456) (:opposite . 24.1206652521855) (:favorable . 0))
;; iter 15 ((:neutral . 17.727890526755353) (:opposite . 24.148097961475152) (:favorable . 0))
;; iter 16 ((:neutral . 17.73317695417412) (:opposite . 24.165205191439718) (:favorable . 0))
;; iter 17 ((:neutral . 17.736473605396206) (:opposite . 24.175873377389507) (:favorable . 0))
;; iter 18 ((:neutral . 17.73852941935781) (:opposite . 24.182526130853237) (:favorable . 0))
;; iter 19 ((:neutral . 17.739811438892666) (:opposite . 24.186674833169743) (:favorable . 0))
;; iter 20 ((:neutral . 17.740610914984774) (:opposite . 24.189261992141937) (:favorable . 0))
;; iter 21 ((:neutral . 17.741109473709628) (:opposite . 24.19087536206488) (:favorable . 0))
;; iter 22 ((:neutral . 17.741420378319376) (:opposite . 24.191881470516293) (:favorable . 0))
;; iter 23 ((:neutral . 17.741614260547443) (:opposite . 24.192508886585898) (:favorable . 0))
;; iter 24 ((:neutral . 17.741735166822824) (:opposite . 24.192900147511928) (:favorable . 0))
;; iter 25 ((:neutral . 17.74181056479804) (:opposite . 24.193144140485096) (:favorable . 0))
;; iter 26 ((:neutral . 17.74185758348792) (:opposite . 24.193296296161765) (:favorable . 0))
;; iter 27 ((:neutral . 17.74188690466255) (:opposite . 24.193391181476052) (:favorable . 0))
;; iter 28 ((:neutral . 17.741905189546372) (:opposite . 24.193450352603048) (:favorable . 0))
;; iter 29 ((:neutral . 17.741916592124216) (:opposite . 24.19348725212007) (:favorable . 0))
;; iter 30 ((:neutral . 17.74192370284927) (:opposite . 24.193510262909722) (:favorable . 0))
;; iter 31 ((:neutral . 17.741928137145756) (:opposite . 24.19352461259457) (:favorable . 0))
;; iter 32 ((:neutral . 17.741930902403183) (:opposite . 24.193533561155586) (:favorable . 0))
;; iter 33 ((:neutral . 17.741932626836515) (:opposite . 24.193539141539066) (:favorable . 0))
;; iter 34 ((:neutral . 17.74193370220486) (:opposite . 24.19354262150414) (:favorable . 0))
;; iter 35 ((:neutral . 17.741934372811873) (:opposite . 24.193544791634015) (:favorable . 0))
;; iter 36 ((:neutral . 17.741934791006962) (:opposite . 24.193546144941756) (:favorable . 0))
;; iter 37 ((:neutral . 17.741935051796265) (:opposite . 24.193546988873663) (:favorable . 0))
;; iter 38 ((:neutral . 17.741935214426245) (:opposite . 24.193547515155338) (:favorable . 0))
;; iter 39 ((:neutral . 17.741935315843406) (:opposite . 24.193547843348167) (:favorable . 0))
;; iter 40 ((:neutral . 17.74193537908784) (:opposite . 24.193548048011447) (:favorable . 0))
;; iter 41 ((:neutral . 17.741935418527497) (:opposite . 24.19354817564086) (:favorable . 0))
;; iter 42 ((:neutral . 17.741935443122337) (:opposite . 24.193548255231427) (:favorable . 0))
;; iter 43 ((:neutral . 17.741935458459842) (:opposite . 24.19354830486465) (:favorable . 0))
;; iter 44 ((:neutral . 17.741935468024415) (:opposite . 24.19354833581626) (:favorable . 0))
;; iter 45 ((:neutral . 17.741935473988953) (:opposite . 24.193548355117898) (:favorable . 0))
;; iter 46 ((:neutral . 17.741935477708473) (:opposite . 24.19354836715453) (:favorable . 0))
;; iter 47 ((:neutral . 17.741935480027998) (:opposite . 24.193548374660654) (:favorable . 0))
;; iter 48 ((:neutral . 17.741935481474464) (:opposite . 24.19354837934153) (:favorable . 0))
;; iter 49 ((:neutral . 17.74193548237649) (:opposite . 24.193548382260552) (:favorable . 0))
;; iter 50 ((:neutral . 17.741935482939002) (:opposite . 24.193548384080874) (:favorable . 0))
;; iter 51 ((:neutral . 17.741935483289787) (:opposite . 24.19354838521604) (:favorable . 0))
;; iter 52 ((:neutral . 17.74193548350854) (:opposite . 24.193548385923936) (:favorable . 0))
;; iter 53 ((:neutral . 17.741935483644955) (:opposite . 24.193548386365386) (:favorable . 0))
;; iter 54 ((:neutral . 17.741935483730025) (:opposite . 24.193548386640675) (:favorable . 0))
;; iter 55 ((:neutral . 17.741935483783074) (:opposite . 24.193548386812346) (:favorable . 0))
;; iter 56 ((:neutral . 17.741935483816157) (:opposite . 24.193548386919403) (:favorable . 0))
;; iter 57 ((:neutral . 17.741935483836787) (:opposite . 24.193548386986166) (:favorable . 0))
;; iter 58 ((:neutral . 17.74193548384965) (:opposite . 24.193548387027796) (:favorable . 0))
;; iter 59 ((:neutral . 17.741935483857674) (:opposite . 24.19354838705376) (:favorable . 0))
;; iter 60 ((:neutral . 17.741935483862676) (:opposite . 24.19354838706995) (:favorable . 0))
;; iter 61 ((:neutral . 17.741935483865795) (:opposite . 24.193548387080046) (:favorable . 0))
;; iter 62 ((:neutral . 17.741935483867742) (:opposite . 24.19354838708634) (:favorable . 0))
;; iter 63 ((:neutral . 17.741935483868957) (:opposite . 24.193548387090267) (:favorable . 0))
;; iter 64 ((:neutral . 17.741935483869714) (:opposite . 24.19354838709272) (:favorable . 0))
;; iter 65 ((:neutral . 17.741935483870186) (:opposite . 24.193548387094246) (:favorable . 0))
;; iter 66 ((:neutral . 17.74193548387048) (:opposite . 24.1935483870952) (:favorable . 0))
;; iter 67 ((:neutral . 17.741935483870662) (:opposite . 24.19354838709579) (:favorable . 0))
;; iter 68 ((:neutral . 17.741935483870776) (:opposite . 24.19354838709616) (:favorable . 0))
;; iter 69 ((:neutral . 17.741935483870847) (:opposite . 24.193548387096392) (:favorable . 0))
;; iter 70 ((:neutral . 17.741935483870893) (:opposite . 24.193548387096534) (:favorable . 0))
;; iter 71 ((:neutral . 17.741935483870922) (:opposite . 24.193548387096627) (:favorable . 0))
;; iter 72 ((:neutral . 17.74193548387094) (:opposite . 24.193548387096683) (:favorable . 0))
;; iter 73 ((:neutral . 17.74193548387095) (:opposite . 24.19354838709672) (:favorable . 0))
;; iter 74 ((:neutral . 17.741935483870957) (:opposite . 24.19354838709674) (:favorable . 0))
;; iter 75 ((:neutral . 17.74193548387096) (:opposite . 24.193548387096754) (:favorable . 0))
;; iter 76 ((:neutral . 17.741935483870964) (:opposite . 24.19354838709676) (:favorable . 0))
;; iter 77 ((:neutral . 17.741935483870964) (:opposite . 24.19354838709677) (:favorable . 0))
;; iter 78 ((:neutral . 17.741935483870968) (:opposite . 24.19354838709677) (:favorable . 0))
;; iter 79 ((:neutral . 17.741935483870968) (:opposite . 24.193548387096772) (:favorable . 0))
;; iter 80 ((:neutral . 17.741935483870968) (:opposite . 24.193548387096776) (:favorable . 0))
;; ((:neutral 17.741935483870968 . Aggressive) (:opposite 24.193548387096776 . Standard) (:favorable . 0))

;; Question 4

;; (solve-mdp question-3)

;; ((:neutral 17.741935483870968 . Aggressive)
;;  (:opposite 24.193548387096776 . Standard)
;;  (:favorable . 0))

;; Question 5

(let ((v-opposite 24.0)
      (v-neutral 17.7))
  (->> (list v-neutral v-opposite)
       (funcall (mdp-tagged-bellman-equations question-3))
       (-zip (mdp-state-names question-4))))

;; ((:neutral 17.71 . Aggressive) (:opposite 24.08 . Standard) (:favorable . 0))

;; Question 6

(+ (* 0.85 0.8 0.5)
   (* 0.15 0.35 0.05)) ; = 0.342625
